<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>To-Do Notify â€“ Linux</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root {
      --bg: #f6f7fb;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --primary: #2563eb;
      --primary-dark: #1e40af;
      --border: #e5e7eb;
    }

    body.dark {
      --bg: #0f172a;
      --card: #111827;
      --text: #f9fafb;
      --muted: #9ca3af;
      --primary: #60a5fa;
      --primary-dark: #3b82f6;
      --border: #1f2933;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: system-ui, -apple-system, BlinkMacSystemFont,
                   "Segoe UI", Roboto, Ubuntu, Cantarell, Arial;
      background: radial-gradient(circle at top, var(--bg), #00000000),
                  var(--bg);
      color: var(--text);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .card {
      background: var(--card);
      border-radius: 20px;
      padding: 36px 34px 30px;
      max-width: 480px;
      width: 100%;
      box-shadow:
        0 30px 60px rgba(0,0,0,0.18),
        inset 0 1px 0 rgba(255,255,255,0.03);
      border: 1px solid var(--border);
      position: relative;
      transition: background 0.3s ease, border 0.3s ease;
    }

    .topbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }

    .badge {
      font-size: 13px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--border);
      color: var(--muted);
    }

    .theme-toggle {
      cursor: pointer;
      border: none;
      background: transparent;
      font-size: 18px;
      color: var(--muted);
    }

    h1 {
      margin: 16px 0 6px;
      font-size: 30px;
      letter-spacing: -0.02em;
    }

    .subtitle {
      margin: 0;
      color: var(--muted);
      font-size: 15.5px;
      line-height: 1.6;
    }

    .download {
      display: block;
      margin-top: 26px;
      padding: 18px 26px;
      background: linear-gradient(135deg, var(--primary), var(--primary-dark));
      color: white;
      text-decoration: none;
      border-radius: 14px;
      font-size: 18px;
      font-weight: 700;
      text-align: center;
      box-shadow: 0 12px 25px rgba(37,99,235,0.35);
      transition: transform 0.15s ease, box-shadow 0.15s ease;
    }

    .download:hover {
      transform: translateY(-2px);
      box-shadow: 0 18px 35px rgba(37,99,235,0.45);
    }

    .stats {
      margin-top: 18px;
      font-size: 14.5px;
      color: var(--muted);
    }

    .stats span {
      font-weight: 700;
      color: var(--text);
    }

    .footer {
      margin-top: 26px;
      font-size: 13.5px;
      color: var(--muted);
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .footer a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }

    .footer a:hover {
      text-decoration: underline;
    }
    .changelog {
    margin-top: 18px;
    text-align: left;
    }

    .changelog-toggle {
    background: none;
    border: none;
    color: var(--primary);
    font-weight: 600;
    cursor: pointer;
    padding: 0;
    font-size: 14.5px;
    }

    .changelog-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.35s ease, opacity 0.25s ease;
    opacity: 0;
    margin-top: 8px;
    font-size: 14px;
    color: var(--muted);
    line-height: 1.6;
    }

    .changelog-content.open {
    max-height: 400px;
    opacity: 1;
    }

    .changelog-content ul {
    padding-left: 18px;
    margin: 6px 0 0;
    }

    .version-select {
    margin-top: 12px;
    font-size: 14px;
    color: var(--muted);
    }

    .version-select select {
    margin-left: 6px;
    padding: 4px 8px;
    border-radius: 6px;
    border: 1px solid var(--border);
    background: var(--card);
    color: var(--text);
    }


  </style>
</head>

<body>
  <div class="card">
    <div class="changelog">
        <button class="changelog-toggle" id="toggleChangelog">
            â–¼ Whatâ€™s new
        </button>

        <div class="changelog-content" id="changelog">
            Loading changelogâ€¦
        </div>
    </div>

    <div class="topbar">
      <div class="badge" id="version">vâ€¦</div>
      <button class="theme-toggle" id="themeToggle" title="Toggle theme">
        ðŸŒ™
      </button>
    </div>

    <div class="version-select">
        Version:
        <select id="versionSelect"></select>
    </div>


    <h1>To-Do Notify</h1>
    <p class="subtitle">
      A modern GTK-based To-Do Manager with smart background notifications
      for Linux.
    </p>

    <a class="download"
       href="https://github.com/sandeep3565-code/ToDoNotify-Releases/releases/latest/download/ToDoNotify_linux_amd64.deb">
      â¬‡ Download for Linux (.deb)
    </a>

    <div class="stats" id="downloads">
      Loading downloadsâ€¦
    </div>

    <div class="footer">
    Â© <span id="year"></span>S Sandeep Kumar. All rights reserved.
    <a href="https://github.com/sandeep3565-code/ToDoNotify-Releases/releases/latest">
        Release details
    </a>
    </div>
  </div>

  <script>
  const OWNER = "sandeep3565-code";
  const REPO  = "ToDoNotify-Releases";

  // ---------- THEME ----------
  const body = document.body;
  const toggle = document.getElementById("themeToggle");

  function applyTheme(theme) {
    body.classList.toggle("dark", theme === "dark");
    toggle.textContent = theme === "dark" ? "â˜€ï¸" : "ðŸŒ™";
    localStorage.setItem("theme", theme);
  }

  const savedTheme = localStorage.getItem("theme");
  const prefersDark = window.matchMedia("(prefers-color-scheme: dark)").matches;
  applyTheme(savedTheme || (prefersDark ? "dark" : "light"));

  toggle.onclick = () =>
    applyTheme(body.classList.contains("dark") ? "light" : "dark");

  // ---------- GITHUB DATA ----------
  const versionSelect = document.getElementById("versionSelect");
  const versionBadge  = document.getElementById("version");
  const downloadBtn   = document.querySelector(".download");
  const changelogBox  = document.getElementById("changelog");

  async function loadReleases() {
    const res = await fetch(
      `https://api.github.com/repos/${OWNER}/${REPO}/releases`
    );
    if (!res.ok) return;

    const releases = await res.json();

    // Populate version dropdown
    releases.forEach((rel, i) => {
      if (rel.draft || rel.prerelease) return;

      const opt = document.createElement("option");
      opt.value = rel.tag_name;
      opt.textContent = rel.tag_name + (i === 0 ? " (latest)" : "");
      versionSelect.appendChild(opt);
    });

    // Load latest by default
    loadRelease(releases[0]);
  }

  async function loadReleaseByTag(tag) {
    const res = await fetch(
      `https://api.github.com/repos/${OWNER}/${REPO}/releases/tags/${tag}`
    );
    if (!res.ok) return;
    loadRelease(await res.json());
  }

  function loadRelease(data) {
    // Version badge
    versionBadge.textContent = data.tag_name;

    // Downloads count
    let total = 0;
    for (const asset of data.assets || []) {
      total += asset.download_count || 0;
    }
    document.getElementById("downloads").innerHTML =
      `â¬‡ <span>${total.toLocaleString()}</span> downloads`;

    // Versioned filename
    const version = data.tag_name.replace(/^v/, "");

    // Versioned download URL
    downloadBtn.href =
      `https://github.com/${OWNER}/${REPO}/releases/download/${data.tag_name}/ToDoNotify_${version}_linux_amd64.deb`;

    // Force correct filename on download
    downloadBtn.setAttribute(
      "download",
      `ToDoNotify_${version}_linux_amd64.deb`
    );

    // Load per-version changelog
    loadChangelogFromBody(data.body || "");
  }

  function loadChangelogFromBody(body) {
    const match = body.match(/## Changes([\s\S]*?)(\n##|\n$)/);
    if (!match) {
      changelogBox.textContent = "No changelog available.";
      return;
    }

    const lines = match[1]
      .split("\n")
      .map(l => l.trim())
      .filter(l => l.startsWith("-"));

    if (!lines.length) {
      changelogBox.textContent = "No changelog available.";
      return;
    }

    changelogBox.innerHTML =
      "<ul>" +
      lines.map(l => `<li>${l.replace(/^- /, "")}</li>`).join("") +
      "</ul>";
  }

  versionSelect.onchange = () =>
    loadReleaseByTag(versionSelect.value);

  document.getElementById("toggleChangelog").onclick = () =>
    changelogBox.classList.toggle("open");

  loadReleases();

  document.getElementById("year").textContent = new Date().getFullYear();

</script>
</body>
</html>
